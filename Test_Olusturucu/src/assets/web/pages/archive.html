{% extends "base.html" %}

{% block title %}Arşiv - TestGen Pro{% endblock %}

{% block content %}
<header
    class="h-16 border-b border-solid border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md px-8 py-3 sticky top-0 z-40 flex items-center justify-between">
    <h2 class="text-lg font-bold">Oluşturulan Testler</h2>
</header>
<main class="flex-1 py-10 px-8">
    <div class="max-w-[1000px] mx-auto">
        <div class="mb-8">
            <h1 class="text-4xl font-black text-slate-900 dark:text-white mb-2">Test Arşivi</h1>
            <p class="text-slate-500">Daha önce oluşturduğunuz tüm testleri buradan indirebilirsiniz.</p>
        </div>

        <div
            class="bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm">
            <table class="w-full text-left">
                <thead>
                    <tr
                        class="bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-800 font-bold text-xs uppercase text-slate-500">
                        <th class="px-6 py-4">Test Dosyası</th>
                        <th class="px-6 py-4">Tarih</th>
                        <th class="px-6 py-4">Boyut</th>
                        <th class="px-6 py-4 text-right">Eylem</th>
                    </tr>
                </thead>
                <tbody id="archive-table-body" class="divide-y divide-slate-100 dark:divide-slate-800">
                    <!-- Loading State -->
                    <tr>
                        <td colspan="4" class="px-6 py-12 text-center text-slate-500">Testler yükleniyor...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
<script>
    async function loadArchive() {
        try {
            const response = await fetch('/api/tests');
            const tests = await response.json();
            const container = document.getElementById('archive-table-body');
            container.innerHTML = '';

            if (tests.length === 0) {
                container.innerHTML = '<tr><td colspan="4" class="px-6 py-12 text-center text-slate-500 font-medium">Henüz oluşturulmuş bir test bulunmuyor.</td></tr>';
                return;
            }

            tests.forEach(test => {
                const date = new Date(test.date * 1000).toLocaleDateString('tr-TR', {
                    day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
                });
                const size = (test.size / (1024 * 1024)).toFixed(2) + ' MB';

                const row = `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                    <td class="px-6 py-5">
                        <div class="flex items-center gap-3">
                            <div class="size-10 rounded bg-rose-50 dark:bg-rose-900/20 text-rose-600 flex items-center justify-center">
                                <span class="material-symbols-outlined" style="width:auto;height:auto">picture_as_pdf</span>
                            </div>
                            <span class="font-bold text-slate-900 dark:text-white truncate max-w-xs">${test.filename}</span>
                        </div>
                    </td>
                    <td class="px-6 py-5 text-sm text-slate-500">${date}</td>
                    <td class="px-6 py-5 text-sm text-slate-500">${size}</td>
                    <td class="px-6 py-5 text-right">
                        <a href="${test.url}" target="_blank" class="inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-lg text-xs font-bold hover:bg-primary hover:text-white transition-all">
                            <span class="material-symbols-outlined text-sm" style="width:auto;height:auto">download</span> İndir
                        </a>
                    </td>
                </tr>`;
                container.innerHTML += row;
            });
        } catch (e) {
            console.error(e);
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadArchive();
    });
</script>
{% endblock %}