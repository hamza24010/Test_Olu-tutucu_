============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- /home/hamzadurna/Projects/Personal/Test_Olusturucu/venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/hamzadurna/Projects/Personal/Test_Olusturucu
configfile: pytest.ini
testpaths: tests
plugins: mock-3.15.1, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/integration/test_question_flow.py::test_question_processing_flow PASSED [  9%]
tests/unit/core/test_gemini_service.py::test_gemini_init_warning FAILED  [ 18%]
tests/unit/core/test_gemini_service.py::test_analyze_chunk_parsing PASSED [ 27%]
tests/unit/core/test_gemini_service.py::test_gemini_api_error_handling PASSED [ 36%]
tests/unit/core/test_pdf_processor.py::test_convert_pdf_to_images PASSED [ 45%]
tests/unit/core/test_pdf_processor.py::test_convert_pdf_exception PASSED [ 54%]
tests/unit/core/test_pdf_processor.py::test_crop_question PASSED         [ 63%]
tests/unit/db/test_db_manager.py::test_add_question PASSED               [ 72%]
tests/unit/db/test_db_manager.py::test_get_questions FAILED              [ 81%]
tests/unit/db/test_db_manager.py::test_delete_question PASSED            [ 90%]
tests/unit/db/test_db_manager.py::test_delete_all PASSED                 [100%]

=================================== FAILURES ===================================
___________________________ test_gemini_init_warning ___________________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7f83f4927ce0>
capsys = <_pytest.capture.CaptureFixture object at 0x7f83f44aeba0>

    def test_gemini_init_warning(monkeypatch, capsys):
        """Test that a warning is printed if API key is missing."""
        # Ensure environment has no key
        monkeypatch.delenv("GEMINI_API_KEY", raising=False)
    
        # Mock genai to prevent actual configure call error if any
>       with pytest.raises(Exception) as e_info:
             ^^^^^^^^^^^^^^^^^^^^^^^^
E       Failed: DID NOT RAISE <class 'Exception'>

tests/unit/core/test_gemini_service.py:12: Failed
______________________________ test_get_questions ______________________________

db_session = <src.db.db_manager.DBManager object at 0x7f83f447f610>

    def test_get_questions(db_session):
        """Test retrieving questions."""
        db_session.add_question("Q1", "p1", "Cat1", "Easy")
        db_session.add_question("Q2", "p2", "Cat1", "Hard")
    
        questions = db_session.get_all_questions()
        assert len(questions) == 2
        # Verify order (DESC usually)
>       assert questions[0][1] == "Q2"  # Depending on schema index for 'text'
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       AssertionError: assert 'Q1' == 'Q2'
E         
E         - Q2
E         + Q1

tests/unit/db/test_db_manager.py:20: AssertionError
---------------------------- Captured stdout setup -----------------------------
Veritabanı başarıyla oluşturuldu: /tmp/tmproj72bl8.db
=============================== warnings summary ===============================
src/core/gemini_service.py:1
  /home/hamzadurna/Projects/Personal/Test_Olusturucu/src/core/gemini_service.py:1: FutureWarning: 
  
  All support for the `google.generativeai` package has ended. It will no longer be receiving 
  updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
  See README for more details:
  
  https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md
  
    import google.generativeai as genai

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.14.2-final-0 ________________

Name                         Stmts   Miss  Cover   Missing
----------------------------------------------------------
src/core/gemini_service.py      41      6    85%   13, 21, 59, 68-69, 87
src/core/pdf_processor.py       40      3    92%   50-52
src/db/db_manager.py            34      0   100%
src/db/init_db.py               18      3    83%   6-7, 51
----------------------------------------------------------
TOTAL                          133     12    91%
=========================== short test summary info ============================
FAILED tests/unit/core/test_gemini_service.py::test_gemini_init_warning - Fai...
FAILED tests/unit/db/test_db_manager.py::test_get_questions - AssertionError:...
==================== 2 failed, 9 passed, 1 warning in 0.96s ====================
