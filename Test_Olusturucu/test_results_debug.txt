============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- /home/hamzadurna/Projects/Personal/Test_Olusturucu/venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/hamzadurna/Projects/Personal/Test_Olusturucu
configfile: pytest.ini
testpaths: tests
plugins: mock-3.15.1, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 12 items

tests/integration/test_question_flow.py::test_question_processing_flow PASSED [  8%]
tests/test_auto_classification.py::TestAutoClassification::test_schema_migration_and_data FAILED [ 16%]
tests/unit/core/test_gemini_service.py::test_gemini_init_warning PASSED  [ 25%]
tests/unit/core/test_gemini_service.py::test_analyze_chunk_parsing PASSED [ 33%]
tests/unit/core/test_gemini_service.py::test_gemini_api_error_handling PASSED [ 41%]
tests/unit/core/test_pdf_processor.py::test_convert_pdf_to_images PASSED [ 50%]
tests/unit/core/test_pdf_processor.py::test_convert_pdf_exception PASSED [ 58%]
tests/unit/core/test_pdf_processor.py::test_crop_question PASSED         [ 66%]
tests/unit/db/test_db_manager.py::test_add_question PASSED               [ 75%]
tests/unit/db/test_db_manager.py::test_get_questions PASSED              [ 83%]
tests/unit/db/test_db_manager.py::test_delete_question PASSED            [ 91%]
tests/unit/db/test_db_manager.py::test_delete_all PASSED                 [100%]

=================================== FAILURES ===================================
____________ TestAutoClassification.test_schema_migration_and_data _____________

self = <tests.test_auto_classification.TestAutoClassification object at 0x7fd8a09f0690>

    def test_schema_migration_and_data(self):
        # Use a temporary DB
        db_path = "tests/test_classification.db"
        if os.path.exists(db_path):
            os.remove(db_path)
    
        # Initialize DB (triggers migration)
        db = DBManager(db_path)
    
        # Verify schema
        conn = db._get_connection()
        c = conn.cursor()
        c.execute("PRAGMA table_info(questions)")
        columns = [row[1] for row in c.fetchall()]
        conn.close()
    
        print(f"Columns found: {columns}")
    
>       assert "subject" in columns
E       AssertionError: assert 'subject' in []

tests/test_auto_classification.py:25: AssertionError
----------------------------- Captured stdout call -----------------------------
Schema migration error: no such table: questions
Columns found: []
=============================== warnings summary ===============================
src/core/gemini_service.py:1
  /home/hamzadurna/Projects/Personal/Test_Olusturucu/src/core/gemini_service.py:1: FutureWarning: 
  
  All support for the `google.generativeai` package has ended. It will no longer be receiving 
  updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
  See README for more details:
  
  https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md
  
    import google.generativeai as genai

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.14.2-final-0 ________________

Name                         Stmts   Miss  Cover   Missing
----------------------------------------------------------
src/core/gemini_service.py      41      5    88%   21, 65, 74-75, 93
src/core/pdf_processor.py       40      3    92%   50-52
src/db/db_manager.py            52      1    98%   27
src/db/init_db.py               18      3    83%   6-7, 51
----------------------------------------------------------
TOTAL                          151     12    92%
=========================== short test summary info ============================
FAILED tests/test_auto_classification.py::TestAutoClassification::test_schema_migration_and_data
=================== 1 failed, 11 passed, 1 warning in 0.97s ====================
