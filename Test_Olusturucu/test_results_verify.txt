============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- /home/hamzadurna/Projects/Personal/Test_Olusturucu/venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/hamzadurna/Projects/Personal/Test_Olusturucu
configfile: pytest.ini
plugins: mock-3.15.1, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1 item

tests/test_auto_classification.py::TestAutoClassification::test_schema_migration_and_data FAILED [100%]

=================================== FAILURES ===================================
____________ TestAutoClassification.test_schema_migration_and_data _____________

self = <tests.test_auto_classification.TestAutoClassification object at 0x7fb7af908910>

    def test_schema_migration_and_data(self):
        # Use a temporary DB
        db_path = "tests/test_classification.db"
        if os.path.exists(db_path):
            os.remove(db_path)
    
        # Initialize DB (triggers migration)
        db = DBManager(db_path)
    
        # Verify schema
        conn = db._get_connection()
        c = conn.cursor()
        c.execute("PRAGMA table_info(questions)")
        columns = [row[1] for row in c.fetchall()]
        conn.close()
    
        print(f"Columns found: {columns}")
    
        assert "subject" in columns
        assert "grade_level" in columns
        assert "difficulty" in columns
    
        # Insert data
        q_id = db.add_question(
            text="Simulated question",
            image_path="path/to/img.png",
            subject="Matematik",
            grade_level="9. Sınıf",
            difficulty=3
        )
    
        # Retrieve
        questions = db.get_all_questions()
        assert len(questions) == 1
        q = questions[0]
    
        print(f"Question Row: {q}")
    
        # Verify data presence
        assert "Matematik" in q
        assert "9. Sınıf" in q
>       assert 3 in q
E       AssertionError: assert 3 in (1, 'Simulated question', 'path/to/img.png', 'Matematik', '3', '2026-01-27 10:14:30', ...)

tests/test_auto_classification.py:48: AssertionError
----------------------------- Captured stdout call -----------------------------
Veritabanı başarıyla oluşturuldu: tests/test_classification.db
Columns found: ['id', 'text', 'image_path', 'category', 'difficulty', 'created_at', 'subject', 'grade_level']
Question Row: (1, 'Simulated question', 'path/to/img.png', 'Matematik', '3', '2026-01-27 10:14:30', 'Matematik', '9. Sınıf')
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.14.2-final-0 ________________

Name                   Stmts   Miss  Cover   Missing
----------------------------------------------------
src/db/db_manager.py      54     13    76%   30, 33-34, 62-66, 69-73
src/db/init_db.py         18      3    83%   6-7, 51
----------------------------------------------------
TOTAL                     72     16    78%
=========================== short test summary info ============================
FAILED tests/test_auto_classification.py::TestAutoClassification::test_schema_migration_and_data
============================== 1 failed in 0.08s ===============================
